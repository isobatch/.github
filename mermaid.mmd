---
config:
  theme: base
  flowchart:
    curve: basis
    padding: 12
    nodeSpacing: 26
    rankSpacing: 24
  themeVariables:
    fontFamily: Inter, Segoe UI, Arial
    fontSize: 12.5px
    lineColor: '#111827'
    primaryColor: '#EEF2F7'
    primaryTextColor: '#0f172a'
    primaryBorderColor: '#64748b'
    secondaryColor: '#FFF9D6'
    tertiaryColor: '#FFF9D6'
---
flowchart LR

 subgraph Bootstrap["Discovery Bootstrap"]
    direction TB
        Seeder["discovery-seed\n(static loader)"]
 end

 subgraph Discovery_Apps["Discovery Applications"]
    direction TB
        HostsApp["hosts-discovery app"]
        PortsApp["ports-discovery app"]
 end

 subgraph Fingerprint_Apps["Service Identification Applications"]
    direction TB
        FingerprintApp["fingerprint app"]
        NegotiateApp["negotiate app"]
 end

 subgraph Kafka_Layer["Kafka"]
    direction TB
        KafkaJobs[("discovery.jobs")]
        KafkaHosts[("hosts.discovered")]
        KafkaEndpoints[("endpoints.discovered")]
        KafkaFingerprint[("fingerprint.detected")]
        KafkaServices[("services.observed")]
 end

 subgraph Observer_App["Service Observer App"]
    direction TB
        ServicesConsumer["Kafka Consumer\n(services.observed)"]
 end

 subgraph Elastic_Layer["Elastic"]
    direction TB
        ElasticServices["services index"]
 end

    Seeder --> KafkaJobs

    KafkaJobs --> HostsApp
    HostsApp --> KafkaHosts
    KafkaHosts --> PortsApp
    PortsApp --> KafkaEndpoints
    KafkaEndpoints --> FingerprintApp
    FingerprintApp --> KafkaFingerprint
    KafkaFingerprint --> NegotiateApp
    NegotiateApp --> KafkaServices

    KafkaServices --> ServicesConsumer
    ServicesConsumer --> ElasticServices

    Seeder:::bootstrap
    HostsApp:::stage
    PortsApp:::stage
    FingerprintApp:::stage
    NegotiateApp:::stage
    ServicesConsumer:::stage

    KafkaJobs:::bus
    KafkaHosts:::bus
    KafkaEndpoints:::bus
    KafkaFingerprint:::bus
    KafkaServices:::bus

    ElasticServices:::store

    classDef bootstrap fill:#FFF9D6,stroke:#8B8BFF,stroke-width:1.3px,color:#0f172a
    classDef stage fill:#EEF2F7,stroke:#64748b,stroke-width:1.3px,color:#0f172a
    classDef bus fill:#EEF2F7,stroke:#64748b,stroke-width:1.3px,color:#0f172a
    classDef store fill:#EEF2F7,stroke:#64748b,stroke-width:1.3px,color:#0f172a

    style Bootstrap fill:#FFF9D6,stroke:#8B8BFF,stroke-width:1.2px,rx:4,ry:4
    style Discovery_Apps fill:#FFF9D6,stroke:#8B8BFF,stroke-width:1.2px,rx:4,ry:4
    style Fingerprint_Apps fill:#FFF9D6,stroke:#8B8BFF,stroke-width:1.2px,rx:4,ry:4
    style Kafka_Layer fill:#FFF9D6,stroke:#8B8BFF,stroke-width:1.2px,rx:4,ry:4
    style Observer_App fill:#FFF9D6,stroke:#8B8BFF,stroke-width:1.2px,rx:4,ry:4
    style Elastic_Layer fill:#FFF9D6,stroke:#8B8BFF,stroke-width:1.2px,rx:4,ry:4
